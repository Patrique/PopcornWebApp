!function(){"use strict";angular.module("popcorn",["ngResource","ngAria","ngMaterial","ngMdIcons","ngCookies","ngAnimate","ngSanitize","ui.router","home","popular","trending","recent","infinite-scroll","movie","angular-imagefit","jkAngularRatingStars","SignalR","player","underscore","login","LocalStorageModule","azure","com.2fdevs.videogular","com.2fdevs.videogular.plugins.controls","com.2fdevs.videogular.plugins.overlayplay","com.2fdevs.videogular.plugins.poster"])}(),function(){"use strict";function a(a,b,c,d,e,f){f.setPrefix("popcorn").setStorageType("sessionStorage").setNotify(!0,!0),c.html5Mode(!0),e.theme("docs-dark","default").primaryPalette("orange").dark(),b.otherwise(function(a){var b=a.get("$state");b.go("login")})}function b(a,b,c){a.previousParams,a.previousState,a.currentState,c.clearAll(),a.$on("$stateChangeStart",function(d,e,f,g,h){return a.previousParams=h,a.previousState=g.name,a.currentState=e.name,"login"===e.name||null!==c.get("userId")&&null!==c.get("mobileServiceAuthenticationToken")?void("home.player"===g.name&&a.$broadcast("HomePlayerExited")):(d.preventDefault(),void b.go("login"))})}angular.module("popcorn").constant("AzureMobileServiceClient",{API_URL:"https://popcornapi.azurewebsites.net/",API_KEY:"B17B3E4ED4632B9E63F37392A86BB767F5D20010412F68A993E97CC918716F13"}).config(a).run(b),angular.module("infinite-scroll").value("THROTTLE_MILLISECONDS",1e3),a.$inject=["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider","$mdThemingProvider","localStorageServiceProvider"],b.$inject=["$rootScope","$state","localStorageService"]}(),function(){"use strict";angular.module("azure",[])}(),function(){"use strict";angular.module("home",[])}(),function(){"use strict";angular.module("login",[])}(),function(){"use strict";angular.module("movie",[])}(),function(){"use strict";angular.module("player",["ngResource"])}(),function(){"use strict";angular.module("popular",["ngResource"])}(),function(){"use strict";angular.module("recent",["ngResource"])}(),function(){"use strict";angular.module("SignalR",[])}(),function(){"use strict";angular.module("trending",["ngResource"])}(),function(){"use strict";angular.module("underscore",[])}(),angular.module("popcorn").config(["$stateProvider",function(a){a.state("home",{url:"","abstract":!0,templateUrl:"app/modules/home/home.html",controller:"HomeCtrl",controllerAs:"vm"})}]),angular.module("login").config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"app/modules/login/login.html",controller:"LoginCtrl",controllerAs:"vm"})}]),angular.module("movie").config(["$stateProvider",function(a){a.state("home.movie",{url:"/movie/:slug",templateUrl:"app/modules/movie/movie.html",controller:"MovieCtrl",controllerAs:"vm",params:{id:null}})}]),angular.module("player").config(["$stateProvider",function(a){a.state("home.player",{url:"/movie/:slug/play",templateUrl:"app/modules/player/player.html",controller:"PlayerCtrl",controllerAs:"vm",params:{movie:null}})}]),angular.module("popular").config(["$stateProvider",function(a){a.state("home.popular",{url:"/popular",templateUrl:"app/modules/popular/popular.html",controller:"PopularCtrl",controllerAs:"vm"})}]),angular.module("recent").config(["$stateProvider",function(a){a.state("home.recent",{url:"/recent",templateUrl:"app/modules/recent/recent.html",controller:"RecentCtrl",controllerAs:"vm"})}]),angular.module("trending").config(["$stateProvider",function(a){a.state("home.trending",{url:"/trending",templateUrl:"app/modules/trending/trending.html",controller:"TrendingCtrl",controllerAs:"vm"})}]),function(){"use strict";function a(){}angular.module("popcorn").controller("HomeCtrl",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){var j=this;j.loading=!1,f.$on("loading",function(){j.loading=!0}),f.$on("loaded",function(){j.loading=!1}),j.tabIndex=c.current.name,f.$on("$stateChangeSuccess",function(a,b){j.tabIndex=b.name}),j.toggleSidenav=function(b){a(b).toggle()},j.querySearch=function(a){var b=h.defer();return g.search(a).$promise.then(function(a){0===a.data.movie_count?b.resolve([]):b.resolve(a.data.movies)}),b.promise},j.searchTextChange=function(a){},j.selectedItemChange=function(a){j.showSearch=!1,j.searchText="",void 0!==a&&c.go("home.movie",{id:a.id,slug:a.slug})}}angular.module("popcorn").controller("LayoutCtrl",a),a.$inject=["$mdSidenav","$cookies","$state","$mdToast","$mdDialog","$rootScope","SearchService","$q","$timeout"]}(),function(){"use strict";function a(a,b,c,d,e,f){var g=this;g.authenticate=function(a){var d=e.getMobileService();f(function(){d.login(a).then(function(a){c.set("userId",a.userId),c.set("mobileServiceAuthenticationToken",a.mobileServiceAuthenticationToken),d.invokeApi("UserInfo",{method:"GET"}).then(function(a){c.set("firstName",a.result.firstName),c.set("lastName",a.result.lastName),c.set("profilePictureUri",a.result.profilePictureUri),c.set("profileId",a.result.id),b.go("home.trending")})})})}}angular.module("login").controller("LoginCtrl",a),a.$inject=["LoginService","$state","localStorageService","$rootScope","MobileServiceClient","$timeout"]}(),function(){"use strict";function a(a,b,c,d,e,f,g){if(null===a.id)return void e.go("home.trending");var h=this;h.movie={},h.loaded=!1,h.goToPlayer=function(a){e.go("home.player",{slug:h.movie.slug,movie:h.movie})},h.config={sources:[],theme:"/app/assets/css/videogular-themes-default/videogular.css",plugins:{poster:h.movie.background}},b.getMovie(a.id).$promise.then(function(a){return h.movie=a.data.movie,h.movie.rating=Math.round(h.movie.rating/2),h.movie.genre=h.movie.genres.join(", "),b.getTMDbInfo(h.movie.imdb_code).$promise}).then(function(a){h.movie.background="https://image.tmdb.org/t/p/original"+a.movie_results[0].backdrop_path;var b=f.getMobileService();b.invokeApi("Movie/GetTrailer",{method:"GET",parameters:{ytCode:h.movie.yt_trailer_code}}).then(function(a){h.movie.trailerUrl=a.result,h.config.sources=[{src:g.trustAsResourceUrl(h.movie.trailerUrl),type:"video/mp4"}]})})["catch"](function(a){h.loaded=!0}),h.imageLoaded=function(){c.$apply(function(){h.loaded=!0,d(function(){$(window).trigger("resize")})})},h.check={scale:"best-fill",onLoad:function(a,b){},onError:function(a,b){},onStart:function(a,b){},align:"center",parent:null,hideParentOverflow:!0,fadeInDuration:400,rescaleOnResize:!0,didScale:function(a,b){}}}angular.module("movie").controller("MovieCtrl",a),a.$inject=["$stateParams","MovieService","$scope","$timeout","$state","MobileServiceClient","$sce"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h,i){var j=this;if(null===c.movie)return void d.go("home.trending");j.API=null,j.onPlayerReady=function(a){j.API=a,g(function(){j.API.play()})},j.movie=c.movie,j.config={sources:[],theme:"/app/assets/css/videogular-themes-default/videogular.css",plugins:{poster:j.movie.background}};var k=[];j.playerReady=!1,j.loaded=!1,j.serverBuffer=0,j.movieBuffer=0,j.check={scale:"best-fill",onLoad:function(a,b){},onError:function(a,b){},onStart:function(a,b){},align:"center",parent:null,hideParentOverflow:!0,fadeInDuration:400,rescaleOnResize:!0,didScale:function(a,b){}},j.imageLoaded=function(){f.$apply(function(){j.loaded=!0,g(function(){$(window).trigger("resize")})})},j.goPrevious=function(){d.go("home.movie",j.movie)},b.$on("StopMovie",function(){j.goPrevious()}),b.$on("HomePlayerExited",function(){l.stop()});var l=e("PopcornHub",j.movie.imdb_code);l.on("DownloadRateChanged",function(a){});var m=!1;l.on("DownloadProgressChanged",function(a){2>=a?j.serverBuffer=Math.round(50*a):j.serverBuffer=100,m||100!==j.serverBuffer||(m=!0,j.config.sources=k,j.playerReady=!0)}),l.on("MovieUpdated",function(a){null!==a.MovieFilePath&&(k=[{src:i.trustAsResourceUrl(a.MovieFilePath),type:"video/mp4"}])}),l.on("MovieFailed",function(a){console.log(a)}),l.start().then(function(){var a=_.first(_.where(j.movie.torrents,{size_bytes:_.min(_.pluck(j.movie.torrents,"size_bytes"))}));l.invokeWithArgs("Download",[a.url,j.movie.imdb_code],function(){})})}angular.module("player").controller("PlayerCtrl",a),a.$inject=["PlayerService","$rootScope","$stateParams","$state","Hub","$scope","$timeout","localStorageService","$sce"]}(),function(){"use strict";function a(a,b,c,d){var e=this;e.page=0,e.movies=[];var f,g=c.getMobileService();g.invokeApi("Movie/GetMovies",{method:"GET"}).then(function(a){f=a.result});var h=function(c){a.getMovies(c).$promise.then(function(a){if(e.page!==a.data.page_number){e.page=a.data.page_number;for(var c=0;c<a.data.movies.length;c++){var d=a.data.movies[c],g=_.findWhere(f,{TmdbId:d.imdb_code});void 0!==g&&(d.like=g.Liked),e.movies.push(d)}b.$broadcast("loaded")}})["catch"](function(a){b.$broadcast("loaded")})};e.paginate=function(){b.$broadcast("loading"),h(e.page+1)},e.toggleLike=function(a){void 0===a.like?a.like=!0:a.like=!a.like;var b={UserProfileId:d.get("profileId"),TmdbId:a.imdb_code,Liked:a.like,Watched:!1};g.invokeApi("Movie/ToggleLike",{body:b})}}angular.module("popular").controller("PopularCtrl",a),a.$inject=["PopularService","$rootScope","MobileServiceClient","localStorageService"]}(),function(){"use strict";function a(a,b,c,d){var e=this;e.page=0,e.movies=[];var f,g=c.getMobileService();g.invokeApi("Movie/GetMovies",{method:"GET"}).then(function(a){f=a.result});var h=function(c){a.getMovies(c).$promise.then(function(a){if(e.page!==a.data.page_number){e.page=a.data.page_number;for(var c=0;c<a.data.movies.length;c++){var d=a.data.movies[c],g=_.findWhere(f,{TmdbId:d.imdb_code});void 0!==g&&(d.like=g.Liked),e.movies.push(d)}b.$broadcast("loaded")}})["catch"](function(a){b.$broadcast("loaded")})};e.paginate=function(){b.$broadcast("loading"),h(e.page+1)},e.toggleLike=function(a){void 0===a.like?a.like=!0:a.like=!a.like;var b={UserProfileId:d.get("profileId"),TmdbId:a.imdb_code,Liked:a.like,Watched:!1};g.invokeApi("Movie/ToggleLike",{body:b})}}angular.module("recent").controller("RecentCtrl",a),a.$inject=["RecentService","$rootScope","MobileServiceClient","localStorageService"]}(),function(){"use strict";function a(a,b,c,d){var e=this;e.page=0,e.movies=[];var f,g=c.getMobileService();g.invokeApi("Movie/GetMovies",{method:"GET"}).then(function(a){f=a.result});var h=function(c){a.getMovies(c).$promise.then(function(a){if(e.page!==a.data.page_number){e.page=a.data.page_number;for(var c=0;c<a.data.movies.length;c++){var d=a.data.movies[c],g=_.findWhere(f,{TmdbId:d.imdb_code});void 0!==g&&(d.like=g.Liked),e.movies.push(d)}b.$broadcast("loaded")}})["catch"](function(a){b.$broadcast("loaded")})};e.paginate=function(){b.$broadcast("loading"),h(e.page+1)},e.toggleLike=function(a){void 0===a.like?a.like=!0:a.like=!a.like;var b={UserProfileId:d.get("profileId"),TmdbId:a.imdb_code,Liked:a.like,Watched:!1};g.invokeApi("Movie/ToggleLike",{body:b})}}angular.module("trending").controller("TrendingCtrl",a),a.$inject=["TrendingService","$rootScope","MobileServiceClient","localStorageService"]}(),function(){"use strict";angular.module("azure").service("MobileServiceClient",function(){var a=new WindowsAzure.MobileServiceClient("https://popcornapi.azurewebsites.net");this.getMobileService=function(){return a}})}(),function(){"use strict";function a(a){return{search:function(b){return a("https://yts.ag/api/v2/list_movies.json").get({query_term:b})}}}angular.module("popular").factory("SearchService",a),a.$inject=["$resource"]}(),function(){"use strict";function a(){return{}}angular.module("login").factory("LoginService",a),a.$inject=[]}(),function(){"use strict";function a(a){return{getMovie:function(b){return a("https://yts.ag/api/v2/movie_details.json").get({movie_id:b,with_images:"true",with_cast:"true"})},getTMDbInfo:function(b){return a("https://api.themoviedb.org/3/find/:id").get({api_key:"a21fe922d3bac6654e93450e9a18af1c",id:b,external_source:"imdb_id"})}}}angular.module("movie").factory("MovieService",a),a.$inject=["$resource"]}(),function(){"use strict";function a(a){return{getMovies:function(b){return a("https://yts.ag/api/v2/list_movies.json").get({sort_by:"download_count",page:b,limit:"30"})}}}angular.module("player").factory("PlayerService",a),a.$inject=["$resource"]}(),function(){"use strict";function a(a){return{getMovies:function(b){return a("https://yts.ag/api/v2/list_movies.json").get({sort_by:"rating",page:b,limit:"30"})}}}angular.module("popular").factory("PopularService",a),a.$inject=["$resource"]}(),function(){"use strict";function a(a){return{getMovies:function(b){return a("https://yts.ag/api/v2/list_movies.json").get({sort_by:"date_added",page:b,limit:"30"})}}}angular.module("recent").factory("RecentService",a),a.$inject=["$resource"]}(),function(){"use strict";angular.module("SignalR").constant("$",$).constant("backendServerUrl","https://server.popcorn.cool").factory("Hub",["$","$rootScope","backendServerUrl","$q","$timeout",function(a,b,c,d,e){function f(b,f){var g=a.hubConnection(c),h=g.createHubProxy(b);return h.connection.qs={ImdbCode:f},{start:function(){var a=d.defer();return g.start().done(function(){a.resolve()}).fail(function(b){a.reject()}),a.promise},stop:function(){g.stop()},on:function(a,b){h.on(a,function(a){e(function(){b&&b(a)})})},invoke:function(a,b){h.invoke(a).done(function(a){e(function(){b&&b(a)})}).fail(function(a){})},invokeWithArgs:function(a,b,c){b.unshift(a),h.invoke.apply(h,b).done(function(a){e(function(){c&&c(a)})}).fail(function(a){})}}}return f}])}(),function(){"use strict";function a(a){return{getMovies:function(b){return a("https://yts.ag/api/v2/list_movies.json").get({sort_by:"download_count",page:b,limit:"30"})}}}angular.module("trending").factory("TrendingService",a),a.$inject=["$resource"]}(),function(){"use strict";function a(){return window._}angular.module("underscore").factory("UnderscoreService",a),a.$inject=[""]}(),function(){"use strict";angular.module("popcorn").directive("imageonload",function(){return{restrict:"A",scope:{imgloaded:"&"},link:function(a,b,c){b.bind("load",function(){a.imgloaded()}),b.bind("error",function(){})}}})}(),function(){"use strict";angular.module("popcorn").directive("stopButton",["$rootScope",function(a){return{restrict:"E",require:"^videogular",template:"<div><md-icon md-svg-src='/app/assets/images/stop.svg' ng-click='stop();'></md-icon></div>",link:function(b,c,d){b.stop=function(){a.$broadcast("StopMovie")}}}}])}();